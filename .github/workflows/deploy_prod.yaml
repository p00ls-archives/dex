name: Deploy Prod
on:
  workflow_dispatch:
    inputs:
      env:
        description: environment
        required: true
        type: choice
        default: 'prod'
        options:
          - 'prod'
          - 'devel'
      ref:
        description: SHA1 to checkout
        required: false
        default: 'latest'
        type: string

jobs:
  deploy_prod:
    if: github.ref == 'refs/heads/main'
    uses: ./.github/workflows/deploy_env.yaml
    with:
      env: ${{ inputs.env }}
      ref: ${{ inputs.ref }}
    concurrency:
      group: ${{ inputs.env}}
      cancel-in-progress: true
    secrets:
      PROJECT_ID: ${{ secrets.PROJECT_ID }}
      GCLOUD_SA: ${{ secrets.GCLOUD_SA }}
      BUCKET_NAME: ${{ secrets.BUCKET_NAME_PROD }}
